{% extends 'motels/base.html' %}

{% load static %}

{% block body %}
<div class="profile px-3">
    <div class="profile-grid-item pl-5 pt-4 pr-2 pb-3">
        <div class="box shadow-sm px-4 py-4">
            <div>
                <p class="full-name">{{ profile.get_full_name }}</p>
                <p class="font-weight-light date-join"><i class="far fa-calendar-alt"></i>  {{ profile.get_date_joined }}</p>
            </div>
            {% if user.is_authenticated and user.id == profile.id %}
                <button id="profile-edit-Btn" class="profile-edit-Btn">Chỉnh sửa hồ sơ</button>
            {% endif %}
        </div>
    </div>
    <div class="profile-grid-item pl-1 pt-4 pr-5 pb-3">
        <div class="box shadow-sm px-4 py-4">
            <div>
                <ul class="profile-horizontal-menu">
                    {% if user.is_authenticated and user.id == profile.id %}
                        <li><a href="">Tất cả</a> </li>
                    {% endif %}
                    <li class="active"><a href="">Đang đăng</a> </li>
                    {% if user.is_authenticated and user.id == profile.id %}
                        <li><a href="">Đang chờ duyệt</a></li>
                        <li><a href="">Đã ẩn</a></li>
                        <li><a href="">Đã bị khóa</a></li>
                    {% endif %}
                </ul>
            </div>
            <div class="d-flex">
                <div class="search2">
                    <input type="text" placeholder="Tìm kiếm" name="search" autocomplete="off">
                    <button type="submit"><i class="fa fa-search"></i></button>
                </div>
                {% if user.is_authenticated and user.id == profile.id %}
                    <a class="nav-link ml-auto" id="link-button-create_post" href="{% url 'create_post_category' %}">Đăng tin</a>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="profile-grid-item pl-5 pt-0 pr-2 pb-3">
        <div class=" px-4 py-4">
            <div>
                {% if user.is_authenticated and user.id == profile.id %}
                <ul class="profile-vertical-menu">
                    <li class="active"><a href="">Tin đăng của bạn</a></li>
                    <li><a href="">Bản nháp</a></li>
                    <li><a href="">Xem lại lịch sử</a></li>
                    <hr>
                    <li><a href="">Ví của bạn</a></li>
                </ul>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="profile-grid-item pl-1 pr-5 pt-0">
        <div class="box  shadow-sm px-4 pt-4 pb-4">
            <!-- ĐANG ĐĂNG -->
            <!-- Bài đăng của người dùng đặt ở đây -->
            {% for post in posts %}
            
            {% if not forloop.first %}
                <hr class="mt-4">
            {% endif %}
            <div class="profile-post-pre">
                <!-- Phải về link chủ bài đăng, không phải chính mình -->
                <a class="pre-post-link-ava" href="{% url 'profile' post.poster.get_full_name_link %}">
                    <img class="profile-post-pre-avatar" src="{{MEDIA_URL}}/{{post.poster.avatar}}" alt="Ảnh đại diện"> 
                </a>
                <a class="pre-post-link-pro post-pre-full-name" href="{% url 'profile' post.poster.get_full_name_link %}"> {{ post.full_name }}</a>
                <a class="update-time" href=""> &#8226; <span>{{ post.getCategory }}</span> &#8226; {{post.getUpdateTime}}</a>
                <div class="row mt-3">
                    <div class="col-md-2">
                        {% if post.image %}
                            <a href="{% url 'view_own_post' post.poster.get_full_name_link post.get_title_link %}"><img class="img-fluid profile-post-pre-image" src="{{MEDIA_URL}}/{{post.image}}" alt="Ảnh bài đăng"></a>
                        {% else %}
                            Bài đăng chưa có ảnh
                        {% endif %}
                    </div>
                    <div class="col-md-7 pr-0">
                        <div><a href="{% url 'view_own_post' post.poster.get_full_name_link post.get_title_link %}" class="text-capitalize">{{post.title}}</a></div>
                        <div class="mt-2 pre-post-description"><span>{{ post.description }}</span></div>
                        <div class="pre-post-address"><i class="fas fa-map-marked-alt"></i> {{post.address}}</div>
                    </div>
                    
                    <div class="col-md-3 p-0">
                        <div class="rent-center"><p>{{post.rent}} <samp>đ/tháng</samp></p></div>
                    </div>
                </div>
            </div>
            {% empty %}
                <small>Bạn chưa đăng tin nào/ Người dùng này hiện đang không cho thuê nhà trọ nào</small>
            {% endfor %}
        </div>
    </div>
</div>

{% if user.is_authenticated and user.id == profile.id %}
<div id="profile-edit-modal" class="modal">
    <div class="modal-content shadow-lg">
        <div class="modal-content-info">
            <div class="row motel-row-header">
                <div class="col-sm-8">
                    <div class="modal-content-header my-3">Chỉnh sửa hồ sơ của bạn</div>
                </div>
                <div class="col-sm-4">
                    <span class="close">&times;</span>
                </div>
            </div>
            <div class="row motel-row-body pt-4 px-3">
                <div class="col-sm-8 pr-4" id="motel-profile-form">
                    <form id="editProForm" action="{% url 'save_profile' %}" method="post" novalidate>
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-sm-6 mb-3">
                                <label for="last_name">Họ</label>
                                <input id="last_name"  name="last_name"  type="text" placeholder="Họ">
                            </div>
                            <div class="col-sm-6 mb-3">
                                <label for="first_name">Tên</label>
                                <input id="first_name" name="first_name" type="text" placeholder="Tên">
                            </div>
                        </div>
                        <div>
                            <label for="user_address">Địa chỉ</label>
                            <select name="address"  id="user_address">
                                <option  selected disabled hidden style='display: none' value="">Tỉnh</option>
                            </select>
                        </div>
                        
                        <div class="mt-4"><input type="button"  id='editProBtn' value="Lưu"></div>
                        
                    </form>
                </div>
                <div class="col-sm-4">
                    <img src="{{MEDIA_URL}}/{{request.user.avatar}}" class="img-thumbnail mg-fluid rounded-circle" alt="Ảnh đại diện của bạn">
                </div>
            </div>
        </div>
    </div>
</div>

{% endif %}

<script src="{% static 'motels/profile.js' %}"></script>
{% endblock %}